<!DOCTYPE html>
<html>
	<head>
		 <meta charset="UTF-8">
		
	</head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
	<body>
		<canvas id="myChart" style="width:100%;max-width:900px"></canvas>
		<script>

			var getJson = async function (){
				
				let xValues = []; 
				let toner = [];
				let unidade = [];
				let kit = [];
				const urlParams = new URLSearchParams(window.location.search);
				const serial = urlParams.get("printer");
				//const serial =  '7018840002TB3'; //teste stand-alone
				const res = await fetch("logSupplies.json");
				const data = await res.json();
				//console.log(data.Toners);
				//console.log(data.Toners.length);
				var t = [];
				var u = [];
				var k = [];
				
				data.forEach(suplly => {
					switch(suplly.tipo){
						case 'toner':
							t.push(suplly);
							break;
						case 'unidade':
							u.push(suplly);
							break;
						case 'kit':
							k.push(suplly);
							break;
						default:
							break;
					}
				});
				console.log(t);
				for(let i = 0; i < t.length; i = i + 1){
					
					if(t[i].printer === serial){
						xValues = t[i].dias;
						toner = t[i].consumo;						
						unidade = u[i].consumo;						
						kit = k[i].consumo;
					}
				}
			console.log(t);
		//const xValues = ['01/06','02/06','03/06','04/06','05/06','06/06','07/06','08/06','09/06','10/06'];
		
		new Chart("myChart", {
		  type: "line",
		 
		  data: {
		    labels: xValues,
		    datasets: [
		    { 
		      data: unidade,
		      borderColor: "red",
		      fill: false,
		      label: "Unidade"
			},
			{ 
		      data: kit,
		      borderColor: "green",
		      fill: false,
		      label: "Kit"
			}
		    ]
		  },
		  options: {
		    legend: {position: 'top'},
			   
		  }
		});
		}
		getJson();
		</script>
		
		
	</body>
</html>